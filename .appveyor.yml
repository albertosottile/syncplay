environment:
  MINICONDA: "C:\\Miniconda"
  PYTHON: "C:\\Python35"
  PYTHON_VERSION: 3.5
  PYTHON_ARCH: 32

platform: x86

configuration: Release

init:
  - set PYTHONPATH=%PYTHON%
  - set PYTHONHOME=%PYTHON%
  - set PATH=%PYTHON%\Scripts;%PYTHON%;C:\Program Files (x86)\NSIS;%PATH%
  - python --version
  - python -m pip install -U pip setuptools wheel
  - pip install -U pypiwin32==219
  - pip install twisted
  - pip install zope.interface
  - type nul > C:\Python34\lib\site-packages\zope\__init__.py
  - curl -L https://bintray.com/alby128/Syncplay/download_file?file_path=py2exe-0.9.2.2-py33.py34.py35-none-any.whl -o py2exe-0.9.2.2-py33.py34.py35-none-any.whl
  - pip install py2exe-0.9.2.2-py33.py34.py35-none-any.whl
  - pip install https://download.qt.io/snapshots/ci/pyside/5.11/latest/pyside2/PySide2-5.11.1a1.dev1530708810518-5.11.1-cp35.cp36.cp37-none-win32.whl
  - pip freeze
  
install:
  - cd %APPVEYOR_BUILD_FOLDER%
  - for /F "tokens=2 delims='" %%a in ('findstr version syncplay\__init__.py') do @set ver=%%a
  - python buildPy2exe.py
  - type nul > syncplay_v%ver%\syncplay.ini
  - copy resources\win_lua_note.txt syncplay_v%ver%\"VLC LUA Script installation.txt"

# Not a project with an msbuild file, build done at install.
build: off

artifacts:
  - path: 'syncplay_v$(ver)'
    type: zip
    name: Syncplay_$(ver)_Portable_Py35

  - path: Syncplay-$(ver)-Setup-Py35.exe
    name: Syncplay-$(ver)-Setup-Py35

# Push artefact to S3 bucket and list all
before_deploy:
  - dir
  - copy Syncplay-%ver%-Setup.exe Syncplay-%ver%-Setup-Py35.exe
  #- python -c "from PySide2 import QtCore; print QtCore.QLibraryInfo.location(QtCore.QLibraryInfo.PluginsPath)"

# Deploy build to BinTray
deploy:
  provider: BinTray
  username: alby128
  api_key:
    secure: lAocj5KA9Z9x4BefQBIgNlQJbeW4qPBfCgYVBHMyOP3NgyhnMLmvR57ZCqtCKBlQ
  subject: alby128
  repo: Syncplay
  package: Syncplay
  version: "test"
  publish: true
  override: true
    